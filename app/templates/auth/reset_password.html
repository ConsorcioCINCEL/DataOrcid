{% extends 'base.html' %}

{% block title %}{{ _('Reset Password Â· Data ORCID-Chile') }}{% endblock %}

{% block header_title %}
<h1 class="m-0 text-dark">{{ _('Password Recovery') }}</h1>
{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{{ url_for('auth.login') }}">{{ _('Login') }}</a></li>
<li class="breadcrumb-item active">{{ _('Reset Password') }}</li>
{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-md-5">
    <div class="card card-outline card-primary shadow-sm">
      <div class="card-header border-0">
        <h3 class="card-title font-weight-bold">
          <i class="fas fa-lock-open mr-2 text-primary"></i> {{ _('Create New Password') }}
        </h3>
      </div>
      
      <form method="post" id="formResetPassword">
        <div class="card-body">
          <p class="text-muted small mb-4">
            {{ _('Please enter and confirm your new password below. Ensure it is secure and easy for you to remember.') }}
          </p>

          <div class="form-group mb-3">
            <label for="new_password" class="small font-weight-bold">{{ _('New Password') }}</label>
            <div class="input-group">
              <input type="password" name="new_password" id="new_password" class="form-control" 
                     required minlength="8" autocomplete="new-password" autofocus>
              <div class="input-group-append">
                <div class="input-group-text bg-white"><i class="fas fa-key"></i></div>
              </div>
            </div>
            <small class="form-text text-muted">{{ _('Minimum 8 characters.') }}</small>
          </div>

          <div class="form-group mb-4">
            <label for="confirm_password" class="small font-weight-bold">{{ _('Confirm New Password') }}</label>
            <div class="input-group">
              <input type="password" name="confirm_password" id="confirm_password" class="form-control" 
                     required minlength="8" autocomplete="new-password">
              <div class="input-group-append">
                <div class="input-group-text bg-white"><i class="fas fa-check"></i></div>
              </div>
            </div>
          </div>
        </div>

        <div class="card-footer bg-white text-right">
          <button type="submit" class="btn btn-primary px-4 shadow-sm font-weight-bold">
            <i class="fas fa-save mr-1"></i> {{ _('Reset & Login') }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
  $(function () {
    // Client-side validation for password matching
    $('#formResetPassword').on('submit', function (e) {
      const p1 = $('#new_password').val();
      const p2 = $('#confirm_password').val();

      if (p1 !== p2) {
        e.preventDefault();
        alert("{{ _('The passwords entered do not match. Please try again.') }}");
        $('#confirm_password').addClass('is-invalid').focus();
      }
    });

    // Clear error style on input
    $('#confirm_password').on('input', function() {
        $(this).removeClass('is-invalid');
    });
  });
</script>
{% endblock %}