{% extends 'base.html' %}

{% block title %}{{ _('Change Password Â· Data ORCID-Chile') }}{% endblock %}

{% block header_title %}
<h1 class="m-0 text-dark">{{ _('Security Settings') }}</h1>
{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{{ url_for('main.index') }}">{{ _('Home') }}</a></li>
<li class="breadcrumb-item active">{{ _('Change Password') }}</li>
{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-md-5">
    <div class="card card-outline card-warning shadow-sm">
      <div class="card-header border-0">
        <h3 class="card-title font-weight-bold">
          <i class="fas fa-key mr-2 text-warning"></i> {{ _('Update Password') }}
        </h3>
      </div>
      
      <form method="post" id="formChangePassword">
        <div class="card-body">
          <p class="text-muted small mb-4">
            {{ _('For your security, please do not share your credentials. Use a strong password with at least 8 characters.') }}
          </p>

          <div class="form-group">
            <label for="current_password">{{ _('Current Password') }}</label>
            <div class="input-group">
              <input type="password" name="current_password" id="current_password" class="form-control" required>
              <div class="input-group-append">
                <span class="input-group-text bg-white"><i class="fas fa-lock"></i></span>
              </div>
            </div>
          </div>

          <hr>

          <div class="form-group">
            <label for="new_password">{{ _('New Password') }}</label>
            <input type="password" name="new_password" id="new_password" class="form-control" 
                   required minlength="8" autocomplete="new-password">
            <small class="form-text text-muted">{{ _('Minimum 8 characters.') }}</small>
          </div>

          <div class="form-group">
            <label for="confirm_password">{{ _('Confirm New Password') }}</label>
            <input type="password" name="confirm_password" id="confirm_password" class="form-control" 
                   required minlength="8" autocomplete="new-password">
          </div>
        </div>

        <div class="card-footer bg-white text-right">
          <a href="{{ url_for('main.index') }}" class="btn btn-link text-muted">{{ _('Cancel') }}</a>
          <button type="submit" class="btn btn-warning px-4 shadow-sm font-weight-bold">
            <i class="fas fa-save mr-1"></i> {{ _('Update Password') }}
          </button>
        </div>
      </form>
    </div>
    
    <div class="alert alert-light border mt-3 small">
        <i class="fas fa-info-circle mr-2 text-info"></i>
        {{ _('If you have forgotten your password, please contact your institutional administrator.') }}
    </div>
  </div>
</div>
{% endblock %}

{% block styles %}
{{ super() }}
<style>
  /* Consistency with ORCID-Chile palette */
  .card-outline.card-warning { border-top: 3px solid #EF5A2F; }
  .btn-warning { background-color: #EF5A2F; border-color: #EF5A2F; color: white !important; }
  .btn-warning:hover { background-color: #d44d25; border-color: #d44d25; }
  .text-warning { color: #EF5A2F !important; }
</style>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
  $(function () {
    // Basic frontend validation to match passwords
    $('#formChangePassword').on('submit', function (e) {
      const newPass = $('#new_password').val();
      const confirmPass = $('#confirm_password').val();

      if (newPass !== confirmPass) {
        e.preventDefault();
        alert("{{ _('New password and confirmation do not match.') }}");
        $('#confirm_password').addClass('is-invalid').focus();
      }
    });

    // Remove invalid class on input
    $('#confirm_password').on('input', function() {
        $(this).removeClass('is-invalid');
    });
  });
</script>
{% endblock %}